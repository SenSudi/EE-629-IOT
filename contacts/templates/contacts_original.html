{% extends 'baseline.html' %}
{% load static %}

{% block head %}
<style type="text/css">
  .even {
    background-color:#dad8d8;
  }
  .odd {
    background-color:#89d699;
  }
  .vc {
    vertical-align:middle;
  }
  .clickable {
    cursor: pointer;
  }
</style>
{% endblock %}

{% block table_pallet %}
<div class="top-spacer"></div>

<div class="col-md-12 white-box">
    <div class="row">
      <div class="col-md-3">
        <button id="btn-add-contact" type="button" class="btn btn-success" style="display:inline;">Add Contact</button>
        <!-- <button class="btn btn-info" id=btn-expand-collapse style="display:inline;">Expand All</button> -->
      </div>
      <div class="col-md-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      </div>
      <div class="col-md-5">
        <div class="form-group">
          <input class="form-control" id="input-search" placeholder="Type to search..." value="" type="input">
        </div>
      </div>
      <div class="col-md-2" style="background-color:#eee;">
        <div class="checkbox checkbox-info">
          <input id="chk-exact-match" type="checkbox">
          <label for="chk-exact-match">Exact Match</label>
        </div>
      </div>
    </div>
    <div class="row">

      <div class="col-sm-3">
        <!-- <span><b>Showing Entries for <span id="showing">All Projects</span></b></span> -->
      </div>

      <div class="col-sm-6">
      
      </div>
    </div>
    
    <hr>
    <div class="row">
    	<div class="col-sm-2"><b>First</b></div>
		  <div class="col-sm-2"><b>Last</b></div>
		  <div class="col-sm-2"><b>e-mail</b></div>
      <div class="col-sm-2"><b>phone</b></div>
		  <div class="col-sm-2"><b>role</b></div>
      <div class="col-sm-2"><b>client</b></div>
    </div>

	<div class="row" id="contacts">
		{% include 'display_contacts.html' %}
	</div>
</div>

<div id="dynamicModal"></div>
<div id="page-data" style="display:none;" data-section="{{section}}"></div>
{% endblock %}

{% block scripts %}
{% include 'js_utils.html' %}
<script type="text/javascript">
  $.get('/get_form/',{'app':'contacts','form':'ContactForm','form_id':'add-contact-form'},function(returned){
    jQuery.data($('#btn-add-contact')[0],'form',returned);
  });

  $(document).on('click','#btn-add-contact',function(){
    var header        = 'Add New Contact';
    var content       = $(this).data('form');
    var strSubmitFunc = "submitForm()";
    var btnText       = "Add Contact";
    doModal('dynamicModal', header, content, strSubmitFunc, btnText);
    var modal = $('#modalWindow');
    modal.find('#btn-modal-form-submit').attr('id','btn-submit-contact');
    var form = modal.find('#add-contact-form');
    form.attr('action','/add_contact/');
    form.attr('method','POST');
    formatForm();
    form.find('label[for=id_client]').append(' (optional)');
  });

  $(document).on('click','#btn-submit-contact',function(){
    var btn = $(this);
    var modal = btn.closest('.modal');
    var form = modal.find('form');
    form.ajaxSubmit(function(returned){
      $('#contacts').empty().html(returned);
      modal.modal('hide');
    });
    return false; 
  });

  $(document).on('click','.clickable',function(){
    var item    = $(this).closest('.item');
    var item_id = item.attr('id');
    var first   = item.find('.first_name').text();
    var last    = item.find('.last_name').text();
    $.get('/get_form/',{'app':'contacts','form':'ContactEditForm','model_type':'Contact','model_app':'contacts','id':item_id,'form_id':'edit-contact-form'},function(returned){
      var header        = 'Edit Details for '+first+' '+last;
      var content       = returned;
      var strSubmitFunc = "submitForm()";
      var btnText       = "Update Contact";
      doModal('dynamicModal', header, content, strSubmitFunc, btnText);
      var modal = $('#modalWindow');
      modal.find('#btn-modal-form-submit').attr('id','btn-update-contact');
      var form = modal.find('form');
      form.attr('action','/update_contact/');
      form.attr('method','POST');
      form.append('<input type="hidden" name="model_id" value="'+item_id+'">');
      form.append('<input type="hidden" name="model_type" value="'+'Contact'+'">');
      form.append('<input type="hidden" name="app" value="'+'contacts'+'">')
      formatForm();
    });
  });

  $(document).on('click','#btn-update-contact',function(){
    var btn   = $(this);
    var modal = btn.closest('.modal');
    var form  = modal.find('form');
    form.ajaxSubmit(function(returned){
      $('#contacts').empty().html(returned);
      modal.modal('hide');
    });
    return false;
  });

  $(document).on('keyup','#input-search',function(){
    // Set search value
    var search = $(this).val();
    // If the search Value is not empty !('').
    if (search.length > 0) {
        // Make all Items invisible
        $('.item').css('display','none');
        // If the form 'ignore case checkbox is checked'
        if ($('#chk-exact-match').is(':checked')) {
            // Create the regex from the search value with ignore case flag
            var re = new RegExp(search);
            // Check each .item to see if the regex matches and display the item if it does
            $.each($('.item'),function(){
                //console.log($(this).text().trim());
                var item = $(this).text()
                if (re.test(item)) {
                    $(this).css('display','block');
                }
            });
        } else {
          // Create the regex from the search value with ignore case flag
          var re = new RegExp(search,"i");
          // Check each .item to see if the regex matches and display the item if it does
          $.each($('.item'),function(){
              //console.log($(this).text().trim());
              var item = $(this).text()
              if (re.test(item)) {
                  $(this).css('display','block');
              }
          });
        }
    } else {
        $('.item').css('display','block');
    }
  });
  
</script>
{% endblock %}